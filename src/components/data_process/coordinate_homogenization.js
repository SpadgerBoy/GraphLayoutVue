export default function convertGridToCart(pos, level) {
    /*
    Args:
        pos: [[x,y],[x,y],[x,y],...]
        level: [1,1,2,2,3,]

    Returns:
        pos: [[x,y],[x,y],[x,y],...]
    */

    let newPos = new Array(pos.length); // 初始化一个与pos长度相同的数组

    let levelNode = [];
    let num = 0;
    let iLevelNodesPos = [];
    let flag = 1;

    // console.log(level.length, pos.length);
    for (let index = 0; index < level.length; index++) {
        let i = level[index];
        if (i === flag) {
            iLevelNodesPos.push(pos[index][0]);
        }

        if (i !== flag || index === level.length - 1) {
            let sortedIndices = iLevelNodesPos.map((val, idx) => [val, idx])
                                               .sort((a, b) => a[0] - b[0])
                                               .map(item => item[1]);
            let rankedIndices = new Array(sortedIndices.length);
            sortedIndices.forEach((j, index0) => {
                rankedIndices[index0] = j + num;
            });
            levelNode.push(rankedIndices);
            
            num += iLevelNodesPos.length;
            iLevelNodesPos = [pos[index][0]];
            flag += 1;
        }
    }
    // console.log('levelNode',levelNode);

    // get each level max width and overall max width
    let maxW = Math.max(...levelNode.map(l => l.length));
    let xstep = 1.0 / maxW;  // abstand zwischen den spalten
    let ystep = 1.0 / levelNode.length;

    let y = ystep / 2.0;
    for (let l of levelNode) {  // for each level l in level
        let x = xstep / 2.0 + (maxW - l.length) / (maxW * 2.0);  // start pos and centering + padding and centering

        for (let i = 0; i < l.length; i++) {
            let n = l[i];       // 获取当前节点id
            newPos[n] = [x, y]; // 将位置赋值给newPos的对应项
            x += xstep;         // 更新x坐标
        }
        y += ystep;
    }

    return newPos;
};


// export default convertGridToCart;


var level = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10];
var pos = [[-0.11531800031661987, 0.05000000074505806], [0.031174805015325546, 0.05000000074505806],[-0.09839949756860733, 0.05000000074505806], [-0.08178920298814774, 0.05000000074505806],[0.016883788630366325, 0.05000000074505806], [-0.08139963448047638, 0.05000000074505806],[-0.08156967908143997, 0.05000000074505806], [-0.08379089832305908, 0.05000000074505806],[0.04601549729704857, 0.05000000074505806], [0.012524745427072048, 0.05000000074505806],[0.010255303233861923, 0.15000000596046448], [0.023953337222337723, 0.15000000596046448],[-0.0851445347070694, 0.15000000596046448], [0.040295135229825974, 0.15000000596046448], [-0.06983362138271332, 0.15000000596046448], [0.01725205034017563, 0.15000000596046448], [-0.07979556918144226, 0.15000000596046448], [0.05042054131627083, 0.15000000596046448], [-0.05644246190786362, 0.15000000596046448], [-0.024099916219711304, 0.15000000596046448], [-0.07477405667304993, 0.15000000596046448], [-0.1128821149468422, 0.15000000596046448], [-0.06734780967235565, 0.25], [0.02505503222346306, 0.25], [-0.08827695995569229, 0.25], [-0.047700610011816025, 0.25], [-0.07684948295354843, 0.25], [0.0114622563123703, 0.25], [-0.05462954565882683, 0.25], [0.0010650352342054248, 0.25], [-0.03877587616443634, 0.25], [-0.0046118879690766335, 0.3499999940395355], [-0.050156120210886, 0.3499999940395355], [0.06875285506248474, 0.3499999940395355], [-0.05495409294962883, 0.3499999940395355], [-0.0068560196086764336, 0.3499999940395355], [-0.09698756039142609, 0.3499999940395355], [-0.054220542311668396, 0.3499999940395355], [0.046144820749759674, 0.3499999940395355], [-0.0525236539542675, 0.3499999940395355], [0.01036849059164524, 0.3499999940395355], [0.012480045668780804, 0.3499999940395355], [-0.018589625135064125, 0.44999998807907104], [-0.08810902386903763, 0.44999998807907104], [-0.011125420220196247, 0.44999998807907104], [-0.06735097616910934, 0.44999998807907104], [0.055287208408117294, 0.44999998807907104], [0.007161589805036783, 0.44999998807907104], [0.0024755606427788734, 0.44999998807907104], [0.07846764475107193, 0.44999998807907104], [-0.04627948999404907, 0.550000011920929], [0.09795117378234863, 0.550000011920929], [-0.008243950083851814, 0.550000011920929], [0.059115637093782425, 0.550000011920929], [-0.05187414214015007, 0.550000011920929], [0.029429251328110695, 0.550000011920929], [-0.08498463779687881, 0.550000011920929], [-0.0364045612514019, 0.550000011920929], [0.04866750165820122, 0.550000011920929], [-0.006718378979712725, 0.550000011920929], [0.04306819289922714, 0.550000011920929], [-0.019228758290410042, 0.550000011920929], [-0.04200925678014755, 0.6499999761581421], [-0.04442710429430008, 0.6499999761581421], [0.05256703123450279, 0.6499999761581421], [-0.01332419365644455, 0.6499999761581421], [0.03935520723462105, 0.6499999761581421], [0.029459184035658836, 0.6499999761581421], [0.05471128970384598, 0.6499999761581421], [-0.0566055066883564, 0.75], [0.012995708733797073, 0.75], [0.054484736174345016, 0.75], [0.04968675971031189, 0.75], [0.05669162794947624, 0.75], [0.04206855967640877, 0.75], [-0.04807238653302193, 0.75], [0.1963769942522049, 0.75], [0.14235731959342957, 0.75], [0.0874514952301979, 0.75], [-0.024338606745004654, 0.75], [-0.050784673541784286, 0.75], [0.05713194981217384, 0.8500000238418579], [0.17195135354995728, 0.8500000238418579], [-0.017849672585725784, 0.8500000238418579], [-0.04314075782895088, 0.8500000238418579], [0.02179110422730446, 0.8500000238418579], [0.07118401676416397, 0.8500000238418579], [0.06710066646337509, 0.8500000238418579], [-0.021791446954011917, 0.8500000238418579], [0.19140072166919708, 0.8500000238418579], [-0.052975039929151535, 0.8500000238418579], [-0.06668184697628021, 0.949999988079071], [0.05102085694670677, 0.949999988079071], [-0.042256757616996765, 0.949999988079071], [0.1963956654071808, 0.949999988079071], [-0.03231201320886612, 0.949999988079071], [0.03198853135108948, 0.949999988079071], [0.06884303689002991, 0.949999988079071], [-0.06646151095628738, 0.949999988079071], [0.20832763612270355, 0.949999988079071]];

//convertGridToCart(pos, level);
